## Path Planning Project
### Writeup by Tony Knight - 2018/02/22

---


<img src="https://raw.githubusercontent.com/teeekay/CarND-MPC-Project/master/examples/MPC_Screenshot2.png?raw=true"  width=700>

<i><u>Figure 1: Snapshot from MPC Video</u></i>

[Link to Youtube video of car running two laps around track](https://youtu.be/4EWSR1dNmNM)

---

### Building code

The code can be built by running
```sh
mkdir build
cmake..
make
```

The model can be run from the build directory by calling:
```sh
./path-plan
```

The executable writes out to a logfile `PPlan.log` in the local directory where the program is run.

The program consists of the following modules which were built on top of [Stanislav Olekhnovich's path planning starter code](https://github.com/fspirit/path-planning-starter) which I used to try and have a cleaner separation of code than is present in the default code provided by Udacity.
I also integrated the external logging code [spdlog](https://github.com/gabime/spdlog) to write output to the screen and logfiles.

| module | Description |
|--------|-------|
|spline.h | external code used to build splines. |
|json.hpp | external code used to decode json in websocket messages.|
|main.cpp | main module which initiates logging and websocket|
|WebSocketMessageHandler.cpp  WebSocketMessageHandler.h | module which decodes websocket json messages, and passes them to the PathPlanner, and returns new path produced by PathPlanner to simulator.|
|CartesianPoint.h | defines structure of cartesian point with (x, y, theta). |
|FrenetPoint.h | defines structures of FrenetPoint with S,D, and FrenetDescription with Frenet references to position, velocity, acceleration and jerk at any point in time.|
|HighwayMap.cpp HighwayMap.h | Module which maps out the Frenet to Cartesian co-ordinates of the centerline of the highway track.|
|PathPlannerInput.h | defines the structure that encompasses all the information passed from the Websocket handler to the Pathplanner.|
|OtherCar.h | defines the structure of details of other cars reported from the simulator.|
|PathPlanner.cpp PathPlanner.h | base class for PathPlanners |
|KeepLanePathPlanner.cpp KeepLanePathPlanner.h | PathPlanner which produces a fixed velocity straight line path along the central lane without concern for acceleration or other cars.  This code is all present in the module.
|SimpleSplineBasedPlanner.cpp SimpleSplineBasedPlanner.h | PathPlanner which produces a path using the spline library in combination with the Jerk minimizing Trajectory (JMT) code, and takes into account other cars, acceleration and velocity.|
|JMTBasedPlanner.cpp JMTBasedPlanner.h | PathPlanner that uses JMT code to build trajectories, taking into account velocity, acceleration and other cars.|
|RoadMap.cpp RoadMap.h | Module used by JMTBasedPathPlanner to map out Other Cars and project their locations in the future to decide if lane or velocity changes should be made.|
|Trajectory.cpp Trajectory.h | Module used by JMTBasedPathPlanner to build and connect JMT trajectories |
|JMT.cpp JMT.h | Module used by SplineBasedPlanner and Trajectory to calculate JMT Frenet paths |
|PathTracking.cpp PathTracking.h | Module implementing a deque which is used to store Cartesian and Frenet information regarding the Trajectory.|

Initially, I worked on developing a method to use the spline to change lanes.  This was relatively easy, and when using a long enough displacement in S between starting and ending the move from the center of one lane to the center of the adjoining lane, and regulating the length between sampled points on the spline to maintain or slowly change forward velocity, there was no issue with exceeding acceleration or jerk limits. I improved the spline based 

I then attempted to build a planner which used the JMT path building code to generate the path without using the 

I used a state machine design with three primary states - `Uninitialized`, `DriveInLane`, and `ChangeLane`.  

`Uninitialized`
---
The role of this state is to start the car moving forward in a straight line with no change in direction.  Once the car has moved forward along almost all the path generated by this state, the car is moved into the 'DriveInLane' state.


`DriveInLane`
---
In this state the car moves in its lane attempting to achieve the maximum speed of 49
